# OpenClaw é¡¹ç›®æ¶æ„åˆ†æ

## é¡¹ç›®æ¦‚è¿°

OpenClaw æ˜¯ä¸€ä¸ªä¸ªäººAIåŠ©æ‰‹å¹³å°ï¼ŒåŸºäºNode.jsæ„å»ºï¼Œé‡‡ç”¨Monorepoæ¶æ„ã€‚å®ƒæ˜¯ä¸€ä¸ªæ”¯æŒå¤šç§é€šä¿¡æ¸ é“ï¼ˆWhatsAppã€Telegramã€Slackã€Discordã€Signalã€iMessageç­‰ï¼‰çš„AIåŠ©æ‰‹ç½‘å…³ï¼Œæä¾›CLIã€Web UIã€ç§»åŠ¨åº”ç”¨ï¼ˆAndroid/iOSï¼‰å’Œæ¡Œé¢åº”ç”¨ï¼ˆmacOSï¼‰ç­‰å¤šå¹³å°ä½“éªŒã€‚

**æŠ€æœ¯æ ˆ**ï¼š
- è¿è¡Œæ—¶ï¼šNode.js â‰¥22.12.0
- åŒ…ç®¡ç†å™¨ï¼špnpm 10.23.0ï¼ˆå·¥ä½œåŒºæ¨¡å¼ï¼‰
- è¯­è¨€ï¼šTypeScriptï¼ˆES2023ç›®æ ‡ï¼‰
- æ„å»ºå·¥å…·ï¼štsdownã€rolldownã€Vite
- æµ‹è¯•æ¡†æ¶ï¼šVitest
- æ¶æ„ï¼šæ¨¡å—åŒ–æ’ä»¶ç³»ç»Ÿï¼Œæ”¯æŒæ‰©å±•

## 1. ç”¨æˆ·æé—®å¤„ç†é€»è¾‘æµç¨‹

### 1.1 æ¶ˆæ¯æ¥æ”¶æ¸ é“

ç”¨æˆ·å¯ä»¥é€šè¿‡ä»¥ä¸‹æ¸ é“å‘OpenClawæé—®ï¼š

1. **æ¶ˆæ¯æ¸ é“**ï¼ˆä¸»è¦æ¸ é“ï¼‰ï¼š
   - WhatsApp Web (`src/web/inbound/monitor.ts`)
   - Telegram (`src/telegram/bot-handlers.ts`)
   - Discord (`extensions/discord/`)
   - Signal (`src/signal/monitor.ts`)
   - Slack (`src/slack/`)
   - iMessage (`src/imessage/`)
   - Line (`src/line/`)
   - å…¶ä»–æ‰©å±•æ¸ é“ (`extensions/`)

2. **CLIå‘½ä»¤è¡Œ**ï¼š
   - `openclaw agent` å‘½ä»¤ (`src/commands/agent.ts`, `src/cli/program/register.agent.ts`)

3. **Web UI/æ§åˆ¶ç•Œé¢**ï¼š
   - Webæ§åˆ¶ç•Œé¢ (`ui/src/ui/`)
   - TUIç»ˆç«¯ç•Œé¢ (`src/tui/`)

4. **Gateway API**ï¼š
   - Gateway HTTP API (`src/gateway/server-methods/chat.ts`)

### 1.2 å¤„ç†æµç¨‹

ç”¨æˆ·æé—®åçš„å®Œæ•´å¤„ç†æµç¨‹å¦‚ä¸‹ï¼š

```
æ¶ˆæ¯æ¥æ”¶ â†’ æ¶ˆæ¯è§£æ â†’ è®¿é—®æ§åˆ¶ â†’ è·¯ç”±åŒ¹é… â†’ ä¼šè¯ç®¡ç† â†’ Agentå¤„ç† â†’ å›å¤åˆ†å‘ â†’ çŠ¶æ€æ›´æ–°
```

#### æ­¥éª¤1ï¼šæ¶ˆæ¯æ¥æ”¶
- å„æ¸ é“çš„monitoræ¨¡å—æ¥æ”¶åŸå§‹æ¶ˆæ¯
- **å…³é”®æ–‡ä»¶**ï¼š
  - `src/web/inbound/monitor.ts` - WhatsApp Webæ¶ˆæ¯ç›‘æ§
  - `src/telegram/bot-handlers.ts` - Telegramæ¶ˆæ¯å¤„ç†å™¨
  - `src/signal/monitor.ts` - Signalæ¶ˆæ¯ç›‘æ§

#### æ­¥éª¤2ï¼šæ¶ˆæ¯è§£æ
- æå–æ¶ˆæ¯å†…å®¹ã€å‘é€è€…ã€åª’ä½“ç­‰ä¿¡æ¯
- è¿›è¡Œæ¶ˆæ¯å»é‡å¤„ç† (`src/web/inbound/dedupe.ts`)

#### æ­¥éª¤3ï¼šè®¿é—®æ§åˆ¶
- æ£€æŸ¥å‘é€è€…æ˜¯å¦åœ¨allowlistä¸­ (`src/web/inbound/access-control.ts`)
- éªŒè¯ç”¨æˆ·æƒé™å’Œèº«ä»½

#### æ­¥éª¤4ï¼šè·¯ç”±åŒ¹é…
- æ ¹æ®é…ç½®çš„è·¯ç”±è§„åˆ™ç¡®å®šä½¿ç”¨å“ªä¸ªagent
- **æ ¸å¿ƒå‡½æ•°**ï¼š`resolveAgentRoute()` (`src/routing/resolve-route.ts`)
- è·¯ç”±åŒ¹é…ä¼˜å…ˆçº§ï¼š
  1. peerç»‘å®š > parent peerç»‘å®š > guildç»‘å®š > teamç»‘å®š > accountç»‘å®š > channelç»‘å®š > é»˜è®¤agent
- ç”Ÿæˆå”¯ä¸€çš„session keyç”¨äºä¼šè¯ç®¡ç†

#### æ­¥éª¤5ï¼šä¼šè¯ç®¡ç†
- åˆ›å»ºæˆ–è·å–ä¼šè¯ä¸Šä¸‹æ–‡
- **å…³é”®æ–‡ä»¶**ï¼š
  - `src/config/sessions.ts` - ä¼šè¯å­˜å‚¨ç®¡ç†
  - `src/config/config.ts` - é…ç½®åŠ è½½

#### æ­¥éª¤6ï¼šAgentå¤„ç†
- è¿è¡Œagentå¤„ç†æ¶ˆæ¯ï¼ˆå¯èƒ½è°ƒç”¨å·¥å…·ã€æ€è€ƒç­‰ï¼‰
- **æ ¸å¿ƒå‡½æ•°**ï¼š`runReplyAgent()` (`src/auto-reply/reply/agent-runner.ts`)
- **å…³é”®æ–‡ä»¶**ï¼š
  - `src/auto-reply/reply/agent-runner.ts` - Agentè¿è¡Œä¸»é€»è¾‘
  - `src/agents/pi-embedded-runner.ts` - PiåµŒå…¥å¼agentè¿è¡Œå™¨
  - `src/agents/cli-runner.ts` - CLI agentè¿è¡Œå™¨

#### æ­¥éª¤7ï¼šå›å¤åˆ†å‘
- å°†å›å¤å‘é€å›ç›¸åº”æ¸ é“
- **æ ¸å¿ƒå‡½æ•°**ï¼š`dispatchInboundMessage()` (`src/auto-reply/dispatch.ts`)

#### æ­¥éª¤8ï¼šçŠ¶æ€æ›´æ–°
- æ›´æ–°ä¼šè¯çŠ¶æ€å’Œç»Ÿè®¡ä¿¡æ¯

### 1.3 æ ¸å¿ƒå¤„ç†æ¨¡å—

**A. æ¶ˆæ¯åˆ†å‘å±‚** (`src/auto-reply/dispatch.ts`):
- `dispatchInboundMessage()` - ä¸»åˆ†å‘å‡½æ•°
- `dispatchReplyFromConfig()` - ä»é…ç½®åˆ†å‘å›å¤

**B. GatewayæœåŠ¡å±‚** (`src/gateway/`):
- `server-methods/chat.ts` - Gatewayçš„èŠå¤©APIå¤„ç†
- `server-chat.ts` - GatewayèŠå¤©æœåŠ¡ç®¡ç†

**C. CLIå‘½ä»¤å±‚** (`src/commands/`):
- `agent.ts` - CLI agentå‘½ä»¤å¤„ç†
- `agent-via-gateway.ts` - é€šè¿‡Gatewayè¿è¡Œagent

## 2. Skillã€MCPã€Toolsè®¾è®¡æ¶æ„

### 2.1 Skillç³»ç»Ÿè®¾è®¡

#### 2.1.1 Skillå®šä¹‰ä¸ç»“æ„
- **ä½ç½®**ï¼š`skills/` ç›®å½•
- **ä½œç”¨**ï¼šä½œä¸ºçŸ¥è¯†åº“ï¼Œé€šè¿‡Markdownæ–‡ä»¶æ•™å¯¼AIå¦‚ä½•ä½¿ç”¨å·¥å…·
- **ç»“æ„ç¤ºä¾‹**ï¼ˆä»¥`skills/mcporter/SKILL.md`ä¸ºä¾‹ï¼‰ï¼š
  ```yaml
  ---
  name: mcporter
  description: Use the mcporter CLI to list, configure, auth, and call MCP servers/tools...
  homepage: http://mcporter.dev
  metadata:
    {
      "openclaw": {
        "emoji": "ğŸ“¦",
        "requires": { "bins": ["mcporter"] },
        "install": [...]
      }
    }
  ---

  # mcporter
  Use `mcporter` to work with MCP servers directly...
  ```

#### 2.1.2 Skillç±»å‹
- **å·¥å…·ä½¿ç”¨æŠ€èƒ½**ï¼šæ•™å¯¼å¦‚ä½•ä½¿ç”¨ç‰¹å®šå·¥å…·ï¼ˆå¦‚1passwordã€githubç­‰ï¼‰
- **é…ç½®æŠ€èƒ½**ï¼šæ•™å¯¼å¦‚ä½•é…ç½®ç³»ç»Ÿ
- **é›†æˆæŠ€èƒ½**ï¼šæ•™å¯¼å¦‚ä½•ä¸å¤–éƒ¨æœåŠ¡é›†æˆ

#### 2.1.3 æŠ€èƒ½ç›®å½•ç¤ºä¾‹ï¼š
- `skills/1password/` - 1Passwordé›†æˆ
- `skills/github/` - GitHubæ“ä½œ
- `skills/mcporter/` - MCPæœåŠ¡å™¨ç®¡ç†
- `skills/session-logs/` - ä¼šè¯æ—¥å¿—ç®¡ç†
- `skills/skill-creator/` - æŠ€èƒ½åˆ›å»ºå·¥å…·

### 2.2 MCPï¼ˆModel Context Protocolï¼‰é›†æˆ

#### 2.2.1 MCPæ”¯æŒ
- é€šè¿‡ `mcporter` æŠ€èƒ½æä¾›MCPæ”¯æŒ
- **å…³é”®æ–‡ä»¶**ï¼š`skills/mcporter/SKILL.md`
- **åŠŸèƒ½**ï¼š
  - åˆ—å‡ºã€é…ç½®ã€è®¤è¯å’Œè°ƒç”¨MCPæœåŠ¡å™¨/å·¥å…·
  - æ”¯æŒHTTPæˆ–stdioè¿æ¥
  - åŒ…æ‹¬ä¸´æ—¶æœåŠ¡å™¨ã€é…ç½®ç¼–è¾‘å’ŒCLI/ç±»å‹ç”Ÿæˆ

#### 2.2.2 MCPå‘½ä»¤ç¤ºä¾‹ï¼š
```bash
mcporter list                          # åˆ—å‡ºMCPæœåŠ¡å™¨
mcporter list <server> --schema        # æŸ¥çœ‹æœåŠ¡å™¨æ¨¡å¼
mcporter call <server.tool> key=value  # è°ƒç”¨å·¥å…·
mcporter auth <server | url> [--reset] # OAuthè®¤è¯
mcporter daemon start|status|stop|restart # å®ˆæŠ¤è¿›ç¨‹ç®¡ç†
```

#### 2.2.3 æœªæ¥è§„åˆ’ï¼š
- è®¡åˆ’å®Œå…¨é›†æˆModel Context Protocol
- é€šè¿‡æ ‡å‡†åŒ–åè®®å®ç°å·¥å…·å’ŒæœåŠ¡å‘ç°

### 2.3 Toolsç³»ç»Ÿè®¾è®¡

#### 2.3.1 å·¥å…·æ¶æ„
- **æ ¸å¿ƒæ–‡ä»¶**ï¼š`src/agents/pi-tools.ts` - å·¥å…·ç³»ç»Ÿä¸»å…¥å£
- **ç­–ç•¥ç®¡ç†**ï¼š`src/agents/tool-policy.ts` - å·¥å…·ç­–ç•¥ç®¡ç†

#### 2.3.2 å·¥å…·åˆ†ç±»å’Œåˆ†ç»„
ç³»ç»Ÿå®šä¹‰äº†å¤šä¸ªå·¥å…·ç»„ï¼Œä¾¿äºæƒé™ç®¡ç†ï¼š

```typescript
export const TOOL_GROUPS: Record<string, string[]> = {
  "group:memory": ["memory_search", "memory_get"],
  "group:web": ["web_search", "web_fetch"],
  "group:fs": ["read", "write", "edit", "apply_patch"],
  "group:runtime": ["exec", "process"],
  "group:sessions": ["sessions_list", "sessions_history", "sessions_send", "sessions_spawn", "session_status"],
  "group:ui": ["browser", "canvas"],
  "group:automation": ["cron", "gateway"],
  "group:messaging": ["message"],
  "group:nodes": ["nodes"],
  "group:openclaw": [...æ‰€æœ‰OpenClawåŸç”Ÿå·¥å…·...]
};
```

#### 2.3.3 å·¥å…·ç­–ç•¥é…ç½®
ç³»ç»Ÿæ”¯æŒå¤šç§å·¥å…·ç­–ç•¥é…ç½®ï¼š

```typescript
const TOOL_PROFILES: Record<ToolProfileId, ToolProfilePolicy> = {
  minimal: { allow: ["session_status"] },
  coding: { allow: ["group:fs", "group:runtime", "group:sessions", "group:memory", "image"] },
  messaging: { allow: ["group:messaging", "sessions_list", "sessions_history", "sessions_send", "session_status"] },
  full: {}  // å…è®¸æ‰€æœ‰å·¥å…·
};
```

#### 2.3.4 å·¥å…·æƒé™æ§åˆ¶
- **æ‰€æœ‰è€…é™åˆ¶å·¥å…·**ï¼šæŸäº›å·¥å…·ä»…é™æ‰€æœ‰è€…ä½¿ç”¨ï¼ˆå¦‚`whatsapp_login`ï¼‰
- **æ’ä»¶å·¥å…·ç®¡ç†**ï¼šæ’ä»¶å·¥å…·å¯ä»¥å•ç‹¬å¯ç”¨æˆ–ç¦ç”¨
- **ç­–ç•¥è§£æ**ï¼šæ”¯æŒallow/denyåˆ—è¡¨ï¼Œæ”¯æŒé€šé…ç¬¦å’Œç»„å¼•ç”¨

#### 2.3.5 å·¥å…·æ‰§è¡Œæµç¨‹
```
å·¥å…·è°ƒç”¨ â†’ æƒé™æ£€æŸ¥ â†’ ç­–ç•¥éªŒè¯ â†’ å‚æ•°æ ‡å‡†åŒ– â†’ å·¥å…·æ‰§è¡Œ â†’ ç»“æœå¤„ç†
```

**å…³é”®å‡½æ•°**ï¼š
- `filterToolsByPolicy()` - æ ¹æ®ç­–ç•¥è¿‡æ»¤å·¥å…·
- `isToolAllowedByPolicies()` - æ£€æŸ¥å·¥å…·æ˜¯å¦å…è®¸
- `resolveEffectiveToolPolicy()` - è§£ææœ‰æ•ˆå·¥å…·ç­–ç•¥

### 2.4 Pluginç³»ç»Ÿè®¾è®¡

#### 2.4.1 æ’ä»¶æ¶æ„
- **æ ¸å¿ƒç›®å½•**ï¼š`src/plugins/` - æ’ä»¶ç³»ç»Ÿå®ç°
- **æ’ä»¶ç±»å‹**ï¼š
  - é€šé“æ’ä»¶ï¼ˆChannel pluginsï¼‰
  - å·¥å…·æ’ä»¶ï¼ˆTool pluginsï¼‰
  - æœåŠ¡æ’ä»¶ï¼ˆService pluginsï¼‰
  - æä¾›è€…æ’ä»¶ï¼ˆProvider pluginsï¼‰

#### 2.4.2 æ’ä»¶å‘ç°å’Œæ³¨å†Œ
- **å…³é”®æ–‡ä»¶**ï¼š`src/plugins/loader.ts` - æ’ä»¶åŠ è½½å™¨
- **æ³¨å†Œè¡¨**ï¼š`src/plugins/registry.ts` - æ’ä»¶æ³¨å†Œè¡¨
- **å·¥å…·æ³¨å†Œ**ï¼š`src/plugins/tools.ts` - æ’ä»¶å·¥å…·æ³¨å†Œ

#### 2.4.3 æ’ä»¶å·¥å…·é›†æˆ
```typescript
// æ’ä»¶å·¥å…·è§£ææµç¨‹
export function resolvePluginTools(params: {
  context: OpenClawPluginToolContext;
  existingToolNames?: Set<string>;
  toolAllowlist?: string[];
}): AnyAgentTool[] {
  // 1. åŠ è½½æ’ä»¶
  // 2. æ£€æŸ¥å†²çª
  // 3. è¿‡æ»¤å…è®¸çš„å·¥å…·
  // 4. è¿”å›å¯ç”¨å·¥å…·
}
```

#### 2.4.4 æ’ä»¶é…ç½®
- **é…ç½®éªŒè¯**ï¼š`src/plugins/config-schema.ts`
- **çŠ¶æ€ç®¡ç†**ï¼š`src/plugins/config-state.ts`
- **å®‰è£…ç®¡ç†**ï¼š`src/plugins/install.ts`

## 3. ç»„ä»¶äº¤äº’å…³ç³»

### 3.1 æ•´ä½“æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   æ¶ˆæ¯æ¸ é“       â”‚    â”‚    Gateway    â”‚    â”‚     CLI      â”‚
â”‚ (WhatsApp,      â”‚â”€â”€â”€â–¶â”‚    APIå±‚      â”‚â”€â”€â”€â–¶â”‚   å‘½ä»¤å±‚     â”‚
â”‚  Telegramç­‰)     â”‚    â”‚              â”‚    â”‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                      â”‚                      â”‚
         â–¼                      â–¼                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  æ¶ˆæ¯è·¯ç”±å’Œåˆ†å‘å±‚                         â”‚
â”‚         (resolve-route.ts, dispatch.ts)                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Agentå¤„ç†å±‚                           â”‚
â”‚          (agent-runner.ts, pi-embedded-runner.ts)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                      â”‚                      â”‚
         â–¼                      â–¼                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Skillç³»ç»Ÿ    â”‚    â”‚  Toolç³»ç»Ÿ     â”‚    â”‚  Pluginç³»ç»Ÿ   â”‚
â”‚  (skills/)   â”‚    â”‚ (pi-tools.ts) â”‚    â”‚ (plugins/)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â–¼
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚  MCPé›†æˆ     â”‚
                        â”‚ (mcporter)   â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 æ•°æ®æµç¤ºä¾‹ï¼šç”¨æˆ·é€šè¿‡WhatsAppæé—®

1. **ç”¨æˆ·å‘é€æ¶ˆæ¯** â†’ WhatsApp Web
2. **æ¶ˆæ¯ç›‘æ§** â†’ `src/web/inbound/monitor.ts`
3. **è®¿é—®æ§åˆ¶** â†’ `src/web/inbound/access-control.ts`
4. **è·¯ç”±è§£æ** â†’ `src/routing/resolve-route.ts`
5. **ä¼šè¯è·å–** â†’ `src/config/sessions.ts`
6. **Agentè¿è¡Œ** â†’ `src/auto-reply/reply/agent-runner.ts`
7. **å·¥å…·è°ƒç”¨** â†’ `src/agents/pi-tools.ts`
   - æ£€æŸ¥å·¥å…·æƒé™ â†’ `src/agents/tool-policy.ts`
   - è°ƒç”¨å…·ä½“å·¥å…· â†’ `src/agents/tools/` ç›®å½•
8. **æŠ€èƒ½æŒ‡å¯¼** â†’ `skills/` ç›¸å…³æŠ€èƒ½æ–‡ä»¶
9. **æ’ä»¶æ‰©å±•** â†’ `src/plugins/tools.ts`ï¼ˆå¦‚æœéœ€è¦ï¼‰
10. **ç»“æœè¿”å›** â†’ åŸæ¸ é“å›å¤ç”¨æˆ·

### 3.3 å…³é”®ä»£ç ä½ç½®æ€»ç»“

#### 3.3.1 ç”¨æˆ·æé—®å¤„ç†
- **è·¯ç”±è§£æ**ï¼š`src/routing/resolve-route.ts:resolveAgentRoute()`
- **æ¶ˆæ¯åˆ†å‘**ï¼š`src/auto-reply/dispatch.ts:dispatchInboundMessage()`
- **Agentè¿è¡Œ**ï¼š`src/auto-reply/reply/agent-runner.ts:runReplyAgent()`
- **Gatewayå¤„ç†**ï¼š`src/gateway/server-methods/chat.ts`
- **CLIå‘½ä»¤**ï¼š`src/commands/agent.ts:agentCommand()`

#### 3.3.2 å·¥å…·ç³»ç»Ÿ
- **å·¥å…·ä¸»å…¥å£**ï¼š`src/agents/pi-tools.ts`
- **ç­–ç•¥ç®¡ç†**ï¼š`src/agents/tool-policy.ts`
- **æƒé™æ§åˆ¶**ï¼š`src/agents/pi-tools.policy.ts`
- **å…·ä½“å·¥å…·**ï¼š`src/agents/tools/` ç›®å½•ä¸‹å„å·¥å…·æ–‡ä»¶

#### 3.3.3 æ’ä»¶ç³»ç»Ÿ
- **æ’ä»¶åŠ è½½**ï¼š`src/plugins/loader.ts:loadOpenClawPlugins()`
- **å·¥å…·æ³¨å†Œ**ï¼š`src/plugins/tools.ts:resolvePluginTools()`
- **æ’ä»¶æ³¨å†Œè¡¨**ï¼š`src/plugins/registry.ts`

#### 3.3.4 Skillç³»ç»Ÿ
- **æŠ€èƒ½ç›®å½•**ï¼š`skills/` ç›®å½•ä¸‹å„æŠ€èƒ½æ–‡ä»¶
- **MCPé›†æˆ**ï¼š`skills/mcporter/SKILL.md`

#### 3.3.5 é…ç½®ç®¡ç†
- **ä¸»é…ç½®**ï¼š`src/config/config.ts`
- **ä¼šè¯ç®¡ç†**ï¼š`src/config/sessions.ts`

## 4. è®¾è®¡ç‰¹ç‚¹æ€»ç»“

### 4.1 æ¨¡å—åŒ–è®¾è®¡
- **å…³æ³¨ç‚¹åˆ†ç¦»**ï¼šæ¸ é“å¤„ç†ã€è·¯ç”±ã€agentæ‰§è¡Œã€å·¥å…·ç®¡ç†å„å¸å…¶èŒ
- **æ’ä»¶åŒ–æ¶æ„**ï¼šæ”¯æŒç¬¬ä¸‰æ–¹æ‰©å±•ï¼Œä¸å½±å“æ ¸å¿ƒç³»ç»Ÿ
- **æŠ€èƒ½ç³»ç»Ÿ**ï¼šå°†çŸ¥è¯†æŒ‡å¯¼ä¸ä»£ç å®ç°åˆ†ç¦»

### 4.2 å®‰å…¨æ€§è®¾è®¡
- **è®¿é—®æ§åˆ¶**ï¼šå¤šå±‚æƒé™éªŒè¯
- **å·¥å…·ç­–ç•¥**ï¼šç»†ç²’åº¦çš„å·¥å…·ä½¿ç”¨æ§åˆ¶
- **æ²™ç®±ç¯å¢ƒ**ï¼šå·¥å…·æ‰§è¡Œåœ¨å—æ§ç¯å¢ƒä¸­
- **æ‰€æœ‰è€…é™åˆ¶**ï¼šæ•æ„Ÿæ“ä½œä»…é™æ‰€æœ‰è€…

### 4.3 æ‰©å±•æ€§è®¾è®¡
- **å¤šæ¸ é“æ”¯æŒ**ï¼šç»Ÿä¸€çš„æ¥å£æ”¯æŒå„ç§æ¶ˆæ¯æ¸ é“
- **æ’ä»¶ç³»ç»Ÿ**ï¼šè§„èŒƒçš„æ’ä»¶å¼€å‘æ¥å£
- **MCPé›†æˆ**ï¼šæ”¯æŒæ ‡å‡†åŒ–åè®®æ‰©å±•
- **é…ç½®é©±åŠ¨**ï¼šå¤§éƒ¨åˆ†è¡Œä¸ºå¯é€šè¿‡é…ç½®è°ƒæ•´

### 4.4 ç”¨æˆ·ä½“éªŒè®¾è®¡
- **å¤šå¹³å°æ”¯æŒ**ï¼šCLIã€Webã€ç§»åŠ¨ç«¯ã€æ¡Œé¢ç«¯
- **ç»Ÿä¸€æ¥å£**ï¼šä¸åŒæ¸ é“æä¾›ä¸€è‡´ä½“éªŒ
- **ä¼šè¯ç®¡ç†**ï¼šä¿æŒä¸Šä¸‹æ–‡è¿ç»­æ€§
- **å®æ—¶åé¦ˆ**ï¼šæ”¯æŒæµå¼å“åº”å’Œè¿›åº¦æç¤º

## 5. æ ¸å¿ƒè®¾è®¡åŸåˆ™

1. **å¯æ‰©å±•æ€§ä¼˜å…ˆ**ï¼šé€šè¿‡æ’ä»¶å’ŒæŠ€èƒ½ç³»ç»Ÿæ”¯æŒåŠŸèƒ½æ‰©å±•
2. **å®‰å…¨æ€§ä¸ºæ ¸å¿ƒ**ï¼šå¤šå±‚æƒé™æ§åˆ¶å’Œæ²™ç®±æ‰§è¡Œç¯å¢ƒ
3. **ä¸€è‡´æ€§ä½“éªŒ**ï¼šè·¨æ¸ é“å’Œå¹³å°æä¾›ç»Ÿä¸€æ¥å£
4. **é…ç½®é©±åŠ¨**ï¼šæœ€å¤§åŒ–é…ç½®çµæ´»æ€§ï¼Œæœ€å°åŒ–ä»£ç ä¿®æ”¹
5. **æ¨¡å—åŒ–æ¶æ„**ï¼šå„ç»„ä»¶èŒè´£æ¸…æ™°ï¼Œä¾¿äºç»´æŠ¤å’Œæµ‹è¯•

---

**åˆ†æå®Œæˆæ—¶é—´**ï¼š2026-02-08
**åˆ†æèŒƒå›´**ï¼šopenclawé¡¹ç›®æ ¸å¿ƒæ¶æ„
**é‡ç‚¹è¦†ç›–**ï¼šç”¨æˆ·æé—®å¤„ç†æµç¨‹ã€Skill/MCP/Toolsè®¾è®¡æœºåˆ¶